%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Copyright 2021 Benjamin Nussbaum
%
% Based on the `metropolis' beamer theme,
% Copyright 2015 Matthias Vogelgesang and the LaTeX community. A full list of
% contributors can be found at
%
%     https://github.com/matze/mtheme/graphs/contributors
%
% and the original template was based on the HSRM theme by Benjamin Weiss.
%
% This work is licensed under a Creative Commons Attribution-ShareAlike 4.0
% International License (https://creativecommons.org/licenses/by-sa/4.0/).

\mode<presentation>

% Give list items more space and allow them to stretch more
\patchcmd{\@listI}
    {\itemsep3\p@ \@plus2\p@ \@minus3\p@}
    {\itemsep14\p@ \@plus10\p@ \@minus12\p@}
    {}{}

% Remove page number on title page
\addtobeamertemplate{title page}{\thispagestyle{empty}}{}

% Option to modify title separator included in metropolis
\setlength{\metropolis@titleseparator@linewidth}{0.4pt} % Default 0.4pt

% ------------------------------------------------------------------------------
% Command to use fancy custom title page style
\newcommand{\titlebg}[2][]
{
    % Define a new page style to set the background image, if provided
    \def\ps@titlebg{
        % If a filename was provided, use it as the title page background image
        \ifx#2\@empty\else
            \usebackgroundtemplate
            {
                \includegraphics[width=\paperwidth,height=\paperheight]{#2}
            }
        \fi
        \@nameuse{ps@empty} % and still remove the page number
    }
    
    % Fix these definitions since metropolis explicitly aligns them left...
    \setbeamertemplate{title}
    {
        % \raggedright%
        \linespread{1.0}%
        \inserttitle%
        \par%
        \vspace*{0.25em}%
    }
    \setbeamertemplate{subtitle}
    {
        % \raggedright%
        \insertsubtitle%
        \par%
        % \vspace*{0.5em}%
    }
    \setbeamertemplate{author}
    {
        \vspace*{0.5em}%
        \insertauthor%
        \par%
        \vspace*{0.25em}%
    }
    
    % Line width of border around the centered title block
    \newlength{\Illinois@titleborder@linewidth}
    \setlength{\Illinois@titleborder@linewidth}{1pt}
    
    % Create the fancy custom title page
    \setbeamertemplate{title page}
    {
        \thispagestyle{titlebg}
        \begin{tikzpicture}[remember picture, overlay]
        \usebeamercolor{title separator}
        \node
        [
            align=center,
            draw,
            line width=\Illinois@titleborder@linewidth,
            fg,
            fill=white,
            fill opacity=0.7
        ] at (current page.center)
        {
            \usebeamercolor{normal text}
            \begin{minipage}[c]{0.75\paperwidth}
                \centering
                \vspace*{2mm}
                \vfill
                \ifx\inserttitlegraphic\@empty\else\usebeamertemplate*{title graphic}\fi
                \vfill
                \ifx\inserttitle\@empty\else\usebeamertemplate*{title}\fi
                \ifx\insertsubtitle\@empty\else\usebeamertemplate*{subtitle}\fi
                \usebeamertemplate*{title separator}
                \ifx\beamer@shortauthor\@empty\else\usebeamertemplate*{author}\fi
                \ifx\insertdate\@empty\else\usebeamertemplate*{date}\fi
                \ifx\insertinstitute\@empty\else\usebeamertemplate*{institute}\fi
                \vfill
                \vspace*{2mm}
            \end{minipage}
        };
        \node[anchor=north east, scale=0.9] at (current page.north east)
        {
            \textcolor{black!15}{\tiny#1}
        };
        \end{tikzpicture}
    }
}

\mode
<all>